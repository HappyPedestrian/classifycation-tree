var A=Object.defineProperty;var g=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var b=(t,l,c)=>l in t?A(t,l,{enumerable:!0,configurable:!0,writable:!0,value:c}):t[l]=c,f=(t,l)=>{for(var c in l||(l={}))H.call(l,c)&&b(t,c,l[c]);if(g)for(var c of g(l))F.call(l,c)&&b(t,c,l[c]);return t};(function(t,l){typeof exports=="object"&&typeof module!="undefined"?module.exports=l(require("vue")):typeof define=="function"&&define.amd?define(["vue"],l):(t=typeof globalThis!="undefined"?globalThis:t||self,t["classify-tree"]=l(t.Vue))})(this,function(t){"use strict";const l=t.defineComponent({inheritAttrs:!1,props:{template:{type:Function},data:{}},setup(){},components:{},data(){return{}},computed:{},watch:{},mounted(){},methods:{},render:e=>t.h("div",[e.template(e.data)])});function c(e,i,s){console.log("\u521B\u5EFA\u4E86observer",e);const a=new MutationObserver(i);return a.observe(e,f({attributes:!0,childList:!0,subtree:!0,characterData:!0},s)),a}var I="",y=(e,i)=>{const s=e.__vccOpts||e;for(const[a,r]of i)s[a]=r;return s};const L=t.defineComponent({name:"ClassifyTreeNode",props:{nodeData:{default:()=>({label:"",key:"",slotScope:"default",expanded:!1})},mode:{default:"vertical"}},setup(e,i){const s=t.inject("slots"),a=t.inject("connectLineOption"),r=t.inject("treeNodeProp"),h={label:(r==null?void 0:r.label)||"label",children:(r==null?void 0:r.children)||"children",key:(r==null?void 0:r.key)||"children"};return t.provide("slots",s||i.slots),t.provide("connectLineOption",a),{slots:s,connectLineOption:a,treeNodeProp:h}},components:{TemplateContainer:l},data(){return{treeNodeElRect:{},connectLinePaths:[],arrowPositions:[],svgStyle:{height:"0",width:"0"},mutationObserver:{},expanded:!1}},computed:{nodeStyle(){return typeof this.nodeData.style=="object"?f({},this.nodeData.style):null},nodeConnectLineOption(){return this.nodeData.connectLineOption?f({},this.connectLineOption):this.connectLineOption},nodeChildrenConnectLineOption(){const e=this.nodeConnectLineOption;return this.nodeData[this.treeNodeProp.children]?this.nodeData[this.treeNodeProp.children].map(i=>{let s=i.connectLineOption||{};return f(f({},e),s)}):[]},showChildren(){return this.nodeData[this.treeNodeProp.children]&&this.nodeData[this.treeNodeProp.children].length>0&&this.expanded!==!1}},watch:{showChildren(e){this.mutationObserverCallback(),setTimeout(()=>{this.mutationObserverCallback()},500)},mode(){this.mutationObserverCallback(),setTimeout(()=>{this.mutationObserverCallback()},500)},"nodeData.expanded"(e){this.expanded=e!==!1}},created(){this.expanded=this.nodeData.expanded!==!1},mounted(){const e=this.$refs.treeNodeContentRef;e&&(this.mutationObserver=c(e.$el,()=>{this.$nextTick(()=>{setTimeout(()=>{this.mutationObserverCallback()},500)})})),this.mutationObserverCallback()},unmounted(){var e;(e=this==null?void 0:this.mutationObserver)!=null&&e.disconnect&&this.mutationObserver.disconnect(),this.$nextTick(()=>{this.mutationObserverCallback()})},methods:{mutationObserverCallback(){var a,r,h;console.log("\u6267\u884C\u4E86callback"),this.connectLinePaths=[],this.arrowPositions=[];const e=this.$refs.treeNodeRef;if(!e)return;this.treeNodeElRect=e.getBoundingClientRect();const i=this.$refs.childNodesBoxRef;let s=(a=this.nodeConnectLineOption)!=null&&a.lineHeight?this.nodeConnectLineOption.lineHeight:"20px";if(i){const n=i.getBoundingClientRect();this.mode==="vertical"?Object.assign(this.svgStyle,{height:s,width:n.width}):this.mode==="horizon"&&Object.assign(this.svgStyle,{height:n.height,width:s});const p=i.children,o=Number.parseInt(s);for(let d of p){const C=d.getBoundingClientRect();if(this.mode==="vertical"){const k=n.left+n.width/2,m=C.left+C.width/2,u=k-m;this.connectLinePaths.push(`M${n.width/2} 0 Q ${n.width/2} ${o/2} ${n.width/2-u/2} ${o/2} Q ${m-n.left} ${o/2} ${m-n.left} ${o-4}`),(r=this.nodeConnectLineOption)!=null&&r.showArrow&&this.arrowPositions.push(`${m-n.left} ${o}`)}else if(this.mode==="horizon"){const k=n.top+n.height/2,m=C.top+C.height/2,u=k-m;this.connectLinePaths.push(`M 0 ${n.height/2} Q ${o/2} ${n.height/2} ${o/2} ${n.height/2-u/2} Q ${o/2} ${m-n.top} ${o-4} ${m-n.top}`),(h=this.nodeConnectLineOption)!=null&&h.showArrow&&this.arrowPositions.push(`${o} ${m-n.top}`)}}}this.$nextTick(()=>{this.$emit("updateConnectLine")})},getChildStyle(e){const i=this.nodeData[this.treeNodeProp.children]?this.nodeData[this.treeNodeProp.children].length:0;return this.mode==="vertical"?{marginRight:e<i-1?"15px":null}:{marginBottom:e<i-1?"15px":null}},onExpandClick(){console.log("expand-click"),this.nodeData.expanded===!1?this.expanded=this.nodeData.expanded=!0:this.expanded=this.nodeData.expanded=!1,console.log("expand-click value:",this.nodeData.expanded)},updateConnectLine(){this.$nextTick(()=>{this.mutationObserverCallback()})}}}),N=e=>(t.pushScopeId("data-v-fce2cb4c"),e=e(),t.popScopeId(),e),O={class:"classify-tree-node-default"},w={class:"classify-tree-node-expand-default"},$=N(()=>t.createElementVNode("span",{class:"minus"},null,-1)),B={key:0,class:"minus add"},D=["height","width"],E=["d","stroke","stroke-width"],P=["d","stroke","fill","transform"],T={key:0,class:"classify-tree-children",ref:"childNodesBoxRef"};function S(e,i,s,a,r,h){const n=t.resolveComponent("TemplateContainer"),p=t.resolveComponent("ClassifyTreeNode",!0);return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["classify-tree-node-wraper",e.mode==="vertical"?"classify-tree-node-wraper-vertical":e.mode==="horizon"?"classify-tree-node-wraper-horizon":null])},[t.createElementVNode("div",{class:t.normalizeClass(["classify-tree-node-content",e.mode==="vertical"?"classify-tree-node-content-vertical":e.mode==="horizon"?"classify-tree-node-content-horizon":null]),ref:"treeNodeRef"},[t.createElementVNode("div",{class:t.normalizeClass(["classify-tree-node",e.nodeData.class]),style:t.normalizeStyle(e.nodeStyle)},[e.slots&&e.slots[e.nodeData.slotScope||"default"]?(t.openBlock(),t.createBlock(n,{key:0,template:e.slots[e.nodeData.slotScope||"default"],data:e.nodeData,ref:"treeNodeContentRef"},null,8,["template","data"])):t.renderSlot(e.$slots,e.nodeData.slotScope||"default",{key:1,data:e.nodeData},()=>[t.createElementVNode("div",O,t.toDisplayString(e.nodeData[e.treeNodeProp.label]),1)],!0)],6),t.createElementVNode("div",{class:t.normalizeClass(["classify-tree-node-expand",e.mode==="vertical"?"classify-tree-node-expand-vertical":e.mode==="horizon"?"classify-tree-node-expand-horizon":null]),onClick:i[0]||(i[0]=(...o)=>e.onExpandClick&&e.onExpandClick(...o))},[e.slots&&e.slots.expand&&e.nodeData[e.treeNodeProp.children]&&e.nodeData[e.treeNodeProp.children].length>0?(t.openBlock(),t.createBlock(n,{key:0,template:e.slots.expand,data:e.nodeData.expanded},null,8,["template","data"])):e.nodeData[e.treeNodeProp.children]&&e.nodeData[e.treeNodeProp.children].length>0?t.renderSlot(e.$slots,"default",{key:1,data:e.expanded},()=>[t.createElementVNode("div",w,[$,e.expanded===!1?(t.openBlock(),t.createElementBlock("span",B)):t.createCommentVNode("",!0)])],!0):t.createCommentVNode("",!0)],2),e.showChildren?(t.openBlock(),t.createElementBlock("div",{key:0,class:t.normalizeClass(["diliver",e.mode==="vertical"?"diliver-vertical":e.mode==="horizon"?"diliver-horizon":null])},[(t.openBlock(),t.createElementBlock("svg",{height:e.svgStyle.height,width:e.svgStyle.width,version:"1.1",xmlns:"http://www.w3.org/2000/svg"},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.connectLinePaths,(o,d)=>(t.openBlock(),t.createElementBlock("path",{d:o,key:d,stroke:e.nodeChildrenConnectLineOption[d]&&e.nodeChildrenConnectLineOption[d].lineColor||"black",fill:"transparent","stroke-width":e.nodeChildrenConnectLineOption[d]&&e.nodeChildrenConnectLineOption[d].lineWidth||2,"stroke-linecap":"round"},null,8,E))),128)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.arrowPositions,(o,d)=>(t.openBlock(),t.createElementBlock("path",{key:d,d:`M ${o} m 0 -4 l 3 -3 l -3 7 l -3 -7 l 3 3`,stroke:e.nodeChildrenConnectLineOption[d]&&e.nodeChildrenConnectLineOption[d].lineColor||"black",fill:e.nodeChildrenConnectLineOption[d]&&e.nodeChildrenConnectLineOption[d].lineColor||"black","stroke-width":"0.2",transform:e.mode==="horizon"?`rotate(-90, ${o})`:void 0,"stroke-linejoin":"miter"},null,8,P))),128))],8,D))],2)):t.createCommentVNode("",!0),t.createVNode(t.Transition,{name:"child-contain-box",onAfterLeave:e.updateConnectLine,onAfterEnter:e.updateConnectLine},{default:t.withCtx(()=>[e.showChildren?(t.openBlock(),t.createElementBlock("div",T,[t.createVNode(t.TransitionGroup,{name:"children-box"},{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.nodeData[e.treeNodeProp.children],(o,d)=>(t.openBlock(),t.createBlock(p,{key:o[e.treeNodeProp.key],"node-data":o,style:t.normalizeStyle(e.getChildStyle(d)),mode:e.mode,onUpdateConnectLine:e.mutationObserverCallback},null,8,["node-data","style","mode","onUpdateConnectLine"]))),128))]),_:1})],512)):t.createCommentVNode("",!0)]),_:1},8,["onAfterLeave","onAfterEnter"])],2)],2)}var z=y(L,[["render",S],["__scopeId","data-v-fce2cb4c"]]),M="";const R=t.defineComponent({name:"ClassifyTree",props:{nodeList:{default:()=>[]},mode:{default:"vertical"},connectLineOption:{default:()=>({})},treeNodeProps:{default:()=>({label:"label",children:"children",key:"key"})}},setup(e,i){var h,n,p;const{connectLineOption:s,treeNodeProps:a}=t.toRefs(e),r={label:((h=a.value)==null?void 0:h.label)||"label",children:((n=a.value)==null?void 0:n.children)||"children",key:((p=a.value)==null?void 0:p.key)||"key"};return t.provide("slots",i.slots),t.provide("connectLineOption",s),t.provide("treeNodeProp",r),{treeNodeProp:r}},components:{ClassifyTreeNode:z,TemplateContainer:l},data(){return{}},computed:{},watch:{},mounted(){},methods:{getChildStyle(e){return this.mode==="vertical"?{marginRight:e<this.nodeList.length-1?"15px":null}:{marginBottom:e<this.nodeList.length-1?"15px":null}}}});function V(e,i,s,a,r,h){const n=t.resolveComponent("ClassifyTreeNode");return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["classify-tree-wraper",e.mode==="vertical"?"classify-tree-wraper-vertical":e.mode==="horizon"?"classify-tree-wraper-horizon":null])},[t.createVNode(t.TransitionGroup,{name:"tree"},{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.nodeList,(p,o)=>(t.openBlock(),t.createBlock(n,{"node-data":p,style:t.normalizeStyle(e.getChildStyle(o)),mode:e.mode,key:p[e.treeNodeProp.key]},null,8,["node-data","style","mode"]))),128))]),_:1})],2)}var j=y(R,[["render",V],["__scopeId","data-v-601de8f4"]]);return j});
