var A=Object.defineProperty;var b=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var g=(t,a,c)=>a in t?A(t,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):t[a]=c,f=(t,a)=>{for(var c in a||(a={}))M.call(a,c)&&g(t,c,a[c]);if(b)for(var c of b(a))v.call(a,c)&&g(t,c,a[c]);return t};(function(t,a){typeof exports=="object"&&typeof module!="undefined"?module.exports=a(require("vue")):typeof define=="function"&&define.amd?define(["vue"],a):(t=typeof globalThis!="undefined"?globalThis:t||self,t["classify-tree"]=a(t.Vue))})(this,function(t){"use strict";const a=t.defineComponent({inheritAttrs:!1,props:{template:{type:Function},data:{}},setup(){},components:{},data(){return{}},computed:{},watch:{},mounted(){this.$emit("mounted")},methods:{},render:e=>t.h("div",[e.template(e.data)])});function c(e,o,l){console.log("\u521B\u5EFA\u4E86observer",e);const s=new MutationObserver(o);return s.observe(e,f({attributes:!0,childList:!0,subtree:!0,characterData:!0},l)),s}var H="",y=(e,o)=>{const l=e.__vccOpts||e;for(const[s,r]of o)l[s]=r;return l};const O=t.defineComponent({name:"ClassifyTreeNode",props:{nodeData:{default:()=>({label:"",key:"",slotScope:"default",expanded:!1})},parent:{default:()=>null},mode:{default:"vertical"}},setup(e,o){const l=t.inject("slots"),s=t.inject("connectLineOption"),r=t.inject("treeNodeProp"),h={label:(r==null?void 0:r.label)||"label",children:(r==null?void 0:r.children)||"children",key:(r==null?void 0:r.key)||"children"};let n={};return e.nodeData.connectLineOption?n=f({},e.nodeData.connectLineOption):n=s,t.provide("slots",l||o.slots),t.provide("connectLineOption",n),{slots:l,nodeConnectLineOption:n,treeNodeProp:h}},components:{TemplateContainer:a},data(){return{treeNodeElRect:{},connectLinePaths:[],arrowPositions:[],svgStyle:{height:"0",width:"0"},mutationObserver:null,expanded:!1}},computed:{nodeStyle(){return typeof this.nodeData.style=="object"?f({},this.nodeData.style):null},nodeChildrenConnectLineOption(){const e=this.nodeConnectLineOption;return this.nodeData[this.treeNodeProp.children]?this.nodeData[this.treeNodeProp.children].map(o=>{let l=o.connectLineOption||{};return f(f({},e),l)}):[]},showChildren(){return this.nodeData[this.treeNodeProp.children]&&this.nodeData[this.treeNodeProp.children].length>0&&this.expanded!==!1}},watch:{showChildren(e){var o;!this.mutationObserver&&e?(this.$nextTick(()=>{this.bindMutationObserver()}),this.mutationObserverCallback(),setTimeout(()=>{this.mutationObserverCallback()},500)):((o=this.mutationObserver)==null||o.disconnect(),this.mutationObserverCallback(),setTimeout(()=>{this.mutationObserverCallback()},500))},mode(){this.mutationObserverCallback(),setTimeout(()=>{this.mutationObserverCallback()},500)},"nodeData.expanded"(e){this.expanded=e!==!1}},created(){this.expanded=this.nodeData.expanded!==!1},mounted(){this.bindMutationObserver(),this.mutationObserverCallback()},beforeUnmount(){var e;(e=this==null?void 0:this.mutationObserver)!=null&&e.disconnect&&this.mutationObserver.disconnect(),this.$nextTick(()=>{this.mutationObserverCallback()})},methods:{bindMutationObserver(){if(this.mutationObserver)return;const e=this.$refs.childNodesBoxRef;e&&(this.mutationObserver=c(e,()=>{this.$nextTick(()=>{setTimeout(()=>{this.mutationObserverCallback()},500)})}))},mutationObserverCallback(){var s,r,h;this.connectLinePaths=[],this.arrowPositions=[];const e=this.$refs.treeNodeRef;if(!e)return;this.treeNodeElRect=e.getBoundingClientRect();const o=this.$refs.childNodesBoxRef;let l=(s=this.nodeConnectLineOption)!=null&&s.lineHeight?this.nodeConnectLineOption.lineHeight:"20px";if(o){const n=o.getBoundingClientRect();this.mode==="vertical"?Object.assign(this.svgStyle,{height:l,width:n.width}):this.mode==="horizon"&&Object.assign(this.svgStyle,{height:n.height,width:l});const p=o.children,i=Number.parseInt(l);for(let d of p){const C=d.getBoundingClientRect();if(this.mode==="vertical"){const u=n.left+n.width/2,m=C.left+C.width/2,k=u-m;this.connectLinePaths.push(`M${n.width/2} 0 Q ${n.width/2} ${i/2} ${n.width/2-k/2} ${i/2} Q ${m-n.left} ${i/2} ${m-n.left} ${i-4}`),(r=this.nodeConnectLineOption)!=null&&r.showArrow&&this.arrowPositions.push(`${m-n.left} ${i}`)}else if(this.mode==="horizon"){const u=n.top+n.height/2,m=C.top+C.height/2,k=u-m;this.connectLinePaths.push(`M 0 ${n.height/2} Q ${i/2} ${n.height/2} ${i/2} ${n.height/2-k/2} Q ${i/2} ${m-n.top} ${i-4} ${m-n.top}`),(h=this.nodeConnectLineOption)!=null&&h.showArrow&&this.arrowPositions.push(`${i} ${m-n.top}`)}}}this.$nextTick(()=>{this.$emit("updateConnectLine")})},getChildStyle(e){const o=this.nodeData[this.treeNodeProp.children]?this.nodeData[this.treeNodeProp.children].length:0;return this.mode==="vertical"?{marginRight:e<o-1?"15px":null}:{marginBottom:e<o-1?"15px":null}},onExpandClick(){console.log("expand-click"),this.nodeData.expanded===!1?this.expanded=this.nodeData.expanded=!0:this.expanded=this.nodeData.expanded=!1,console.log("expand-click value:",this.nodeData.expanded)},updateConnectLine(){this.$nextTick(()=>{this.mutationObserverCallback()})}}}),L=e=>(t.pushScopeId("data-v-0cc7d1a8"),e=e(),t.popScopeId(),e),N={class:"classify-tree-node-default"},$={class:"classify-tree-node-expand-default"},w=L(()=>t.createElementVNode("span",{class:"minus"},null,-1)),B={key:0,class:"minus add"},D=["height","width"],T=["d","stroke","stroke-width"],E=["d","stroke","fill","transform"],P={key:0,class:"classify-tree-children",ref:"childNodesBoxRef"};function S(e,o,l,s,r,h){const n=t.resolveComponent("TemplateContainer"),p=t.resolveComponent("ClassifyTreeNode",!0);return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["classify-tree-node-wraper",e.mode==="vertical"?"classify-tree-node-wraper-vertical":e.mode==="horizon"?"classify-tree-node-wraper-horizon":null])},[t.createElementVNode("div",{class:t.normalizeClass(["classify-tree-node-content",e.mode==="vertical"?"classify-tree-node-content-vertical":e.mode==="horizon"?"classify-tree-node-content-horizon":null]),ref:"treeNodeRef"},[t.createElementVNode("div",{class:t.normalizeClass(["classify-tree-node",e.nodeData.class]),style:t.normalizeStyle(e.nodeStyle),ref:"treeNodeContentRef"},[e.slots&&e.slots[e.nodeData.slotScope||"default"]?(t.openBlock(),t.createBlock(n,{key:0,template:e.slots[e.nodeData.slotScope||"default"],data:{node:e.nodeData,parent:e.parent}},null,8,["template","data"])):t.renderSlot(e.$slots,e.nodeData.slotScope||"default",{key:1,data:{node:e.nodeData,parent:e.parent}},()=>[t.createElementVNode("div",N,t.toDisplayString(e.nodeData[e.treeNodeProp.label]),1)],!0)],6),t.createElementVNode("div",{class:t.normalizeClass(["classify-tree-node-expand",e.mode==="vertical"?"classify-tree-node-expand-vertical":e.mode==="horizon"?"classify-tree-node-expand-horizon":null]),onClick:o[0]||(o[0]=(...i)=>e.onExpandClick&&e.onExpandClick(...i))},[e.slots&&e.slots.expand&&e.nodeData[e.treeNodeProp.children]&&e.nodeData[e.treeNodeProp.children].length>0?(t.openBlock(),t.createBlock(n,{key:0,template:e.slots.expand,data:e.nodeData.expanded},null,8,["template","data"])):e.nodeData[e.treeNodeProp.children]&&e.nodeData[e.treeNodeProp.children].length>0?t.renderSlot(e.$slots,"default",{key:1,data:e.expanded},()=>[t.createElementVNode("div",$,[w,e.expanded===!1?(t.openBlock(),t.createElementBlock("span",B)):t.createCommentVNode("",!0)])],!0):t.createCommentVNode("",!0)],2),e.showChildren?(t.openBlock(),t.createElementBlock("div",{key:0,class:t.normalizeClass(["diliver",e.mode==="vertical"?"diliver-vertical":e.mode==="horizon"?"diliver-horizon":null])},[(t.openBlock(),t.createElementBlock("svg",{height:e.svgStyle.height,width:e.svgStyle.width,version:"1.1",xmlns:"http://www.w3.org/2000/svg"},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.connectLinePaths,(i,d)=>(t.openBlock(),t.createElementBlock("path",{d:i,key:d,stroke:e.nodeChildrenConnectLineOption[d]&&e.nodeChildrenConnectLineOption[d].lineColor||"black",fill:"transparent","stroke-width":e.nodeChildrenConnectLineOption[d]&&e.nodeChildrenConnectLineOption[d].lineWidth||2,"stroke-linecap":"round"},null,8,T))),128)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.arrowPositions,(i,d)=>(t.openBlock(),t.createElementBlock("path",{key:d,d:`M ${i} m 0 -4 l 3 -3 l -3 7 l -3 -7 l 3 3`,stroke:e.nodeChildrenConnectLineOption[d]&&e.nodeChildrenConnectLineOption[d].lineColor||"black",fill:e.nodeChildrenConnectLineOption[d]&&e.nodeChildrenConnectLineOption[d].lineColor||"black","stroke-width":"0.2",transform:e.mode==="horizon"?`rotate(-90, ${i})`:void 0,"stroke-linejoin":"miter"},null,8,E))),128))],8,D))],2)):t.createCommentVNode("",!0),t.createVNode(t.Transition,{name:"child-contain-box",onAfterLeave:e.updateConnectLine,onAfterEnter:e.updateConnectLine},{default:t.withCtx(()=>[e.showChildren?(t.openBlock(),t.createElementBlock("div",P,[t.createVNode(t.TransitionGroup,{name:"children-box"},{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.nodeData[e.treeNodeProp.children],(i,d)=>(t.openBlock(),t.createBlock(p,{key:i[e.treeNodeProp.key],"node-data":i,parent:e.nodeData,style:t.normalizeStyle(e.getChildStyle(d)),mode:e.mode,onUpdateConnectLine:e.mutationObserverCallback},null,8,["node-data","parent","style","mode","onUpdateConnectLine"]))),128))]),_:1})],512)):t.createCommentVNode("",!0)]),_:1},8,["onAfterLeave","onAfterEnter"])],2)],2)}var z=y(O,[["render",S],["__scopeId","data-v-0cc7d1a8"]]),F="";const R=t.defineComponent({name:"ClassifyTree",props:{nodeList:{default:()=>[]},mode:{default:"vertical"},connectLineOption:{default:()=>({})},treeNodeProps:{default:()=>({label:"label",children:"children",key:"key"})}},setup(e,o){var h,n,p;const{connectLineOption:l,treeNodeProps:s}=t.toRefs(e),r={label:((h=s.value)==null?void 0:h.label)||"label",children:((n=s.value)==null?void 0:n.children)||"children",key:((p=s.value)==null?void 0:p.key)||"key"};return t.provide("slots",o.slots),t.provide("connectLineOption",l),t.provide("treeNodeProp",r),{treeNodeProp:r}},components:{ClassifyTreeNode:z,TemplateContainer:a},data(){return{}},computed:{},watch:{},mounted(){},methods:{getChildStyle(e){return this.mode==="vertical"?{marginRight:e<this.nodeList.length-1?"15px":null}:{marginBottom:e<this.nodeList.length-1?"15px":null}}}});function V(e,o,l,s,r,h){const n=t.resolveComponent("ClassifyTreeNode");return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["classify-tree-wraper",e.mode==="vertical"?"classify-tree-wraper-vertical":e.mode==="horizon"?"classify-tree-wraper-horizon":null])},[t.createVNode(t.TransitionGroup,{name:"tree"},{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.nodeList,(p,i)=>(t.openBlock(),t.createBlock(n,{"node-data":p,style:t.normalizeStyle(e.getChildStyle(i)),mode:e.mode,key:p[e.treeNodeProp.key]},null,8,["node-data","style","mode"]))),128))]),_:1})],2)}var j=y(R,[["render",V],["__scopeId","data-v-2d060326"]]);return j});
